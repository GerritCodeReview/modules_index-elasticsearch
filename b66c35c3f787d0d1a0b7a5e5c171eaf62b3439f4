{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2465ca4f_46b432d1",
        "filename": "src/main/java/com/google/gerrit/elasticsearch/AbstractElasticIndex.java",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-07-06T22:51:57Z",
      "side": 1,
      "message": "This is making every post request include refresh params, but that\u0027s not appropriate for a generic postRequest() method. I\u0027m all for the optimization you\u0027re trying to make, but I think the callers still need to provide the params.",
      "range": {
        "startLine": 310,
        "startChar": 48,
        "endLine": 310,
        "endChar": 61
      },
      "revId": "b66c35c3f787d0d1a0b7a5e5c171eaf62b3439f4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb4394fe_8c2df89e",
        "filename": "src/main/java/com/google/gerrit/elasticsearch/AbstractElasticIndex.java",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2022-07-08T10:13:58Z",
      "side": 1,
      "message": "This is a new method that was added in this change (the old one was unused and was removed in the previous change). All caller sites, that used old method: `postRequest(String uri, Object payload, Map\u003cString, String\u003e params)` were changed to use this new method.\n\nIn the base version the freshly created refreshParams instance was created on the fly and passed in to the now deleted method. The new postRequest() method, without the refreshParams, is using immutable instance of that map, created in ctor.\n\nOr may be I missed something? Could you post a stacktrace of the caller site, where refresh\u003dtrue is wrongly used?",
      "parentUuid": "2465ca4f_46b432d1",
      "range": {
        "startLine": 310,
        "startChar": 48,
        "endLine": 310,
        "endChar": 61
      },
      "revId": "b66c35c3f787d0d1a0b7a5e5c171eaf62b3439f4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0c87d73_f7c85a21",
        "filename": "src/main/java/com/google/gerrit/elasticsearch/AbstractElasticIndex.java",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-07-08T21:06:05Z",
      "side": 1,
      "message": "\u003e Or may be I missed something? Could you post a stacktrace of the caller site, where refresh\u003dtrue is wrongly used?\n\nI think I wasn\u0027t clear enough. This isn\u0027t a bug, it\u0027s a layering misuse/violation.\n\nA method named postRequest() in this class should work for any POST to an Elasticsearch API. If you always include a refresh parameter, it\u0027s not generic to any ES API as many do not take refresh as a param.\n\nThere\u0027s probably a few different ways you can keep postRequest() generic and still only create the params hash once (some kind of constant comes to mind). Let me know if you need more ideas for that.",
      "parentUuid": "bb4394fe_8c2df89e",
      "range": {
        "startLine": 310,
        "startChar": 48,
        "endLine": 310,
        "endChar": 61
      },
      "revId": "b66c35c3f787d0d1a0b7a5e5c171eaf62b3439f4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4596ebb4_48fc9dd0",
        "filename": "src/main/java/com/google/gerrit/elasticsearch/AbstractElasticIndex.java",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2022-07-08T21:11:03Z",
      "side": 1,
      "message": "\u003e There\u0027s probably a few different ways you can keep postRequest() generic and still only create the params hash once (some kind of constant comes to mind). Let me know if you need more ideas for that.\n\nActually I think it\u0027s even simpler since this is the base class (and in the following change you dynamically set the refresh value, so you don\u0027t want a constant). Just replace where callers had `getRefreshParam()` with `refreshParam` (the variable should probably still be singular like the method was).",
      "parentUuid": "b0c87d73_f7c85a21",
      "range": {
        "startLine": 310,
        "startChar": 48,
        "endLine": 310,
        "endChar": 61
      },
      "revId": "b66c35c3f787d0d1a0b7a5e5c171eaf62b3439f4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b274979_95f76518",
        "filename": "src/main/java/com/google/gerrit/elasticsearch/AbstractElasticIndex.java",
        "patchSetId": 1
      },
      "lineNbr": 310,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2022-07-12T16:15:14Z",
      "side": 1,
      "message": "I see your point. I tried to improve the situation by renaming the method  to `postRequestWithRefreshParam()`. Let me know, if your concerns resolved with this rename. Another alternative would be, as you suggested, to restore the base version, and pass in `refreshParam` parameter.",
      "parentUuid": "4596ebb4_48fc9dd0",
      "range": {
        "startLine": 310,
        "startChar": 48,
        "endLine": 310,
        "endChar": 61
      },
      "revId": "b66c35c3f787d0d1a0b7a5e5c171eaf62b3439f4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}